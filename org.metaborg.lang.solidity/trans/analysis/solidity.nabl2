module analysis/solidity

imports

  signatures/-

signature
  name resolution
  
  namespaces
    Import { iname : string }
  
  sorts
    
  
  constructors
    

rules

  init ^ (programScope) :=
    new programScope.

  [[ Program(elements) ^ (programScope) ]] :=
    Map1 [[ elements ^ (programScope) ]],
    
    distinct/name D(programScope)/Import         | error $[Two imports with the same name: [NAME]] @NAMES,
    distinct/name D(programScope)/Contract       | error $[Duplicate contract [NAME]] @NAMES,
    distinct/name D(programScope)/Interface      | error $[Duplicate interface [NAME]] @NAMES,
    distinct/name D(programScope)/Library        | error $[Duplicate library [NAME]] @NAMES,
    distinct/name D(programScope)/TypeReferrable | error $[Duplicate type [NAME]] @NAMES.

  //We can ignore pragmas
  [[ Pragma(name, version) ^ (programScope) ]].
  
  //We cannot determine anything from a direct file import
  [[ ImportFromFile(file) ^ (programScope) ]].
    
  
  [[ Import(items, file) ^ (programScope) ]] :=
    Map1 [[ items ^ (programScope) ]].
    
    
  [[ ImportStar(name) ^ (programScope) ]] :=
    TypeReferrable{name} <- programScope,
    Import{name}         <- programScope,
    Import{name}.iname := "*".
  
  [[ ImportItem(name, as) ^ (programScope) ]] :=
    TypeReferrable{as} <- programScope,
    Import{as}         <- programScope,
    Import{as}.iname := name.